<template>
	<view class="container">
		<uv-collapse @change="change" @close="close" @open="open">
			<uv-collapse-item title="APIæ¥å£ï¼š wx.updateShareMenu" name="Docs guide">
				<view>
					åº”ç”¨åœºæ™¯ï¼š
					<p>â‘ è®¾ç½®åŠ¨æ€æ¶ˆæ¯ï¼ŒåŠ¨æ€æ¶ˆæ¯å¯å†è½¬å‘ååŠ¨æ€ä¿®æ”¹å†…å®¹ä»¥åŠè®¾ç½®æ¨é€æç¤ºï¼›</p>
					<p>â‘¡è®¾ç½®ç¾¤å†…æ¶ˆæ¯ä¸å¯è½¬å‘ï¼›</p>
					<p>â‘¢æ ¹æ®ç”¨æˆ·çŠ¶æ€ç”ŸæˆåŠ¨æ€åˆ†äº«å¡ç‰‡/æ§åˆ¶åˆ†äº«æƒé™/æ”¯æŒå¼‚æ­¥æ“ä½œï¼›</p>
					<p>â‘£ç¾¤èŠåœºæ™¯ä¸­è·å– ShareTicket</p>
					<p>
						â‘¤è®¾ç½®ç§å¯†æ¶ˆæ¯ï¼šç§å¯†æ¶ˆæ¯åŠŸèƒ½æ˜¯è¿™æ ·ä¸€ç§èƒ½åŠ›ï¼šå½“åˆ†äº«è€…åˆ†äº«å°ç¨‹åºå¡ç‰‡ç»™å…¶ä»–ç”¨æˆ·æˆ–è€…å¾®ä¿¡ç¾¤åï¼Œå…¶ä»–ç”¨æˆ·ç‚¹å‡»æ­¤å°ç¨‹åºå¡ç‰‡æ—¶ï¼Œå¼€å‘è€…å¯ä»¥é‰´åˆ«å‡ºç‚¹å‡»å¡ç‰‡çš„ç”¨æˆ·æ˜¯å¦è¢«åˆ†äº«è€…åˆ†äº«è¿‡å°ç¨‹åºå¡ç‰‡ã€‚s
					</p>
				</view>
			</uv-collapse-item>
		</uv-collapse>
		<uv-button @tap="setUpdateShare" icon="star-fill" type="success" text="æ›´æ–°è½¬å‘å±æ€§"></uv-button>
		<uv-collapse @change="change" @close="close" @open="open">
			<uv-collapse-item title="APIæ¥å£ï¼š wx.showShareMenu" name="Docs guide">
				<view>
					åº”ç”¨åœºæ™¯ï¼š
					<p>â‘ ç‰¹å®šé¡µé¢ç¦ç”¨åˆ†äº«åˆ°æœ‹å‹åœˆï¼›</p>
					<p>â‘¡æ ¹æ®ç”¨æˆ·çŠ¶æ€ç”ŸæˆåŠ¨æ€åˆ†äº«å¡ç‰‡/æ§åˆ¶åˆ†äº«æƒé™/æ”¯æŒå¼‚æ­¥æ“ä½œï¼›</p>
					<p>â‘¢ç¾¤èŠåœºæ™¯ä¸­è·å– ShareTicket</p>
				</view>
			</uv-collapse-item>
		</uv-collapse>
		<uv-button @tap="shareMenuShow" type="success" text="è½¬å‘åˆ†äº«è®¾ç½®"></uv-button>
		<uv-collapse @change="change" @close="close" @open="open">
			<uv-collapse-item title="APIæ¥å£ï¼š wx.hideShareMenu" name="Docs guide">
				<view>
					åº”ç”¨åœºæ™¯ï¼š
					<p>â‘ ç‰¹å®šé¡µé¢ç¦ç”¨åˆ†äº«åˆ°æœ‹å‹åœˆï¼›</p>
					<p>â‘¡æ ¹æ®ç”¨æˆ·çŠ¶æ€ç”ŸæˆåŠ¨æ€åˆ†äº«å¡ç‰‡/æ§åˆ¶åˆ†äº«æƒé™/æ”¯æŒå¼‚æ­¥æ“ä½œï¼›</p>
					<p>â‘¢ç¾¤èŠåœºæ™¯ä¸­è·å– ShareTicket</p>
				</view>
				<view>æ³¨æ„ï¼šæš‚åªåœ¨ Android å¹³å°æ”¯æŒ</view>
			</uv-collapse-item>
		</uv-collapse>
		<uv-button @tap="shareMenuHide" type="success" text="è½¬å‘åˆ†äº«éšè—"></uv-button>
		<uv-collapse @change="change" @close="close" @open="open">
			<uv-collapse-item title="APIæ¥å£ï¼š wx.showShareImageMenu" name="Docs guide">
				<view></view>
			</uv-collapse-item>
		</uv-collapse>
		<uv-button @tap="shareImage" type="success" text="å›¾ç‰‡æ¶ˆæ¯åˆ†äº«"></uv-button>
		<uv-collapse @change="change" @close="close" @open="open">
			<uv-collapse-item title="APIæ¥å£ï¼š wx.shareVideoMessage" name="Docs guide">
				<view></view>
			</uv-collapse-item>
		</uv-collapse>
		<uv-button @tap="shareVoide" type="success" text="è§†é¢‘æ¶ˆæ¯åˆ†äº«"></uv-button>
		<uv-collapse @change="change" @close="close" @open="open">
			<uv-collapse-item title="APIæ¥å£ï¼š wx.shareFileMessage" name="Docs guide">
				<view></view>
			</uv-collapse-item>
		</uv-collapse>
		<uv-button @tap="shareFlies" type="success" text="æ–‡ä»¶æ¶ˆæ¯åˆ†äº«"></uv-button>
		<uv-collapse @change="change" @close="close" @open="open">
			<uv-collapse-item title="APIæ¥å£ï¼š wx.onCopyUrl" name="Docs guide">
				<view>æ³¨æ„ï¼šæš‚åªåœ¨ Android å¹³å°æ”¯æŒ</view>
			</uv-collapse-item>
		</uv-collapse>
		<uv-button @tap="copyUrl" type="success" text="å¤åˆ¶é“¾æ¥ç›‘å¬"></uv-button>
		<uv-collapse @change="change" @close="close" @open="open">
			<uv-collapse-item title="APIæ¥å£ï¼š wx.offCopyUrl" name="Docs guide">
				<view>æ³¨æ„ï¼šæš‚åªåœ¨ Android å¹³å°æ”¯æŒ</view>
			</uv-collapse-item>
		</uv-collapse>
		<uv-button @tap="offCopy" type="success" text="å¤åˆ¶é“¾æ¥ç›‘å¬å…³é—­"></uv-button>
		<uv-line margin="30" color="#2979ff"></uv-line>

		<!-- åŠ¨æ€æ¶ˆæ¯åŠŸèƒ½åŒºåŸŸ -->
		<view class="dynamic-message-section">
			<text class="section-title">ğŸš€ åŠ¨æ€æ¶ˆæ¯åŠŸèƒ½</text>
			<view class="button-group">
				<uv-button @tap="shareDynamicMessage" type="primary" text="è½¬å‘åŠ¨æ€æ¶ˆæ¯" icon="share-fill"></uv-button>
				<uv-button @tap="authPrivate" type="warning" text="éªŒè¯ç§å¯†æ¶ˆæ¯" icon="edit-pen-fill"></uv-button>
			</view>
			<view class="tips">
				<text class="tip-text">ğŸ’¡ åŠ¨æ€æ¶ˆæ¯ç‰¹ç‚¹ï¼š</text>
				<text class="tip-item">â€¢ æ”¯æŒåå°åŠ¨æ€ä¿®æ”¹æ¶ˆæ¯å†…å®¹</text>
				<text class="tip-item">â€¢ ç”¨æˆ·å¯è®¢é˜…æ¶ˆæ¯æé†’</text>
				<text class="tip-item">â€¢ ä»…åœ¨ç¾¤èŠä¸­ç”Ÿæ•ˆä¸”ä¸å¯å†æ¬¡è½¬å‘</text>
				<text class="tip-item">â€¢ éœ€è¦é…åˆæœåŠ¡ç«¯æ¥å£ä½¿ç”¨</text>
			</view>
		</view>

		<!-- <button :dataset="{ id: 999 }" open-type="share">è‡ªå®šä¹‰åˆ†äº«æŒ‰é’®</button> -->
	</view>
</template>

<script setup>
	import {
		ref
	} from "vue";
	import {
		onLoad,
		onUnload,
		onShareAppMessage,
		onShareTimeline
	} from "@dcloudio/uni-app";

	// æ·»åŠ ç¼ºå¤±çš„äº‹ä»¶å¤„ç†æ–¹æ³•
	const change = (e) => {
		console.log("æŠ˜å é¢æ¿å˜åŒ–:", e);
	};

	const close = (name) => {
		console.log("é¢æ¿å…³é—­:", name);
	};

	const open = (name) => {
		console.log("é¢æ¿æ‰“å¼€:", name);
	};

	onLoad((option) => {
		copyUrl(); //è¿›å…¥é¡µé¢æ—¶è°ƒç”¨ wx.onCopyUrl è‡ªå®šä¹‰ query
		console.log("option", option);
		// å¯ä»¥åœ¨é¡µé¢è‡ªå®šä¹‰è½¬å‘é…ç½®å®Œæˆæ—¶å†éšè—åŠŸèƒ½ï¼Œé…ç½®ä¿¡æ¯ä¸ä¼šé‡ç½®
		// shareMenuHide();
	});
	onUnload(() => {
		copyOff(); //é€€å‡ºé¡µé¢æ—¶è°ƒç”¨ wx.offCopyUrlï¼Œé˜²æ­¢å½±å“å…¶å®ƒé¡µé¢
	});

	/**
	 * @desc è½¬å‘åŠ¨æ€æ¶ˆæ¯åˆ°å¾®ä¿¡è”è°ƒä¸­
	 */
	const shareDynamicMessage = () => {
		// æ¨¡æ‹ŸåŠ¨æ€æ¶ˆæ¯çš„æ´»åŠ¨IDï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦ä»æœåŠ¡ç«¯è·å–
		const activityId = "1327_bkU7UKry/nvzrLxXY2SMZnrnwBBAK2JHBK7c0_CplGvRFKQ05MhzyxwRK4vbYqRtETjIvUoZ8UW_z7Zy";

		wx.updateShareMenu({
			// æ”¯æŒè½¬å‘åŠ¨æ€æ¶ˆæ¯
			isUpdatableMessage: true,
			// åŠ¨æ€æ¶ˆæ¯IDï¼Œéœ€è¦æ ¹æ®æœåŠ¡ç«¯æ¥å£è·å–
			activityId: activityId,
			// æ³¨æ„ï¼šåªæœ‰è½¬å‘åˆ°ç¾¤èŠä¸­æ‰“å¼€æ‰å¯ä»¥è·å–åˆ° shareTicket è¿”å›å€¼
			withShareTicket: true,
			// åŠ¨æ€æ¶ˆæ¯æ¨¡æ¿ä¿¡æ¯
			templateInfo: {
				parameterList: [{
						name: "member_count",
						value: "1"
					},
					{
						name: "room_limit",
						value: "10"
					},
					{
						name: "path",
						value: "pages/wxExample/share"
					},
					{
						name: "version_type",
						value: "develop"
					}
				]
			},
			success: (res) => {
				console.log("åŠ¨æ€æ¶ˆæ¯è®¾ç½®æˆåŠŸ:", res);
				uni.showToast({
					title: "åŠ¨æ€æ¶ˆæ¯è®¾ç½®æˆåŠŸ",
					icon: "success"
				});
			},
			fail: (err) => {
				console.error("åŠ¨æ€æ¶ˆæ¯è®¾ç½®å¤±è´¥:", err);
				uni.showToast({
					title: "åŠ¨æ€æ¶ˆæ¯è®¾ç½®å¤±è´¥",
					icon: "none"
				});
			}
		});
	};
	/**
	 * @desc ç§å¯†æ¶ˆæ¯éªŒè¯
	 * */
	const authPrivate = () => {
		wx.authPrivateMessage({
			shareTicket: "xxxxxx",
			success(res) {
				console.log("authPrivateMessage success", res);
				// res
				// {
				//   errMsg: 'authPrivateMessage:ok'
				//   valid: true
				//   iv: 'xxxx',
				//   encryptedData: 'xxxxxx'
				// }
			},
			fail(res) {
				console.log("authPrivateMessage fail", res);
			}
		});
	};
	/**
	 * @desc æ›´æ–°åŠ¨æ€æ¶ˆæ¯å†…å®¹ï¼ˆæ¨¡æ‹ŸæœåŠ¡ç«¯æ›´æ–°ï¼‰
	 */
	const updateDynamicMessage = () => {
		// è¿™ä¸ªåŠŸèƒ½éœ€è¦é…åˆæœåŠ¡ç«¯æ¥å£ä½¿ç”¨
		// å®é™…åº”ç”¨ä¸­éœ€è¦è°ƒç”¨æœåŠ¡ç«¯æ¥å£æ¥æ›´æ–°åŠ¨æ€æ¶ˆæ¯å†…å®¹
		uni.showModal({
			title: "æç¤º",
			content: "åŠ¨æ€æ¶ˆæ¯å†…å®¹æ›´æ–°éœ€è¦é…åˆæœåŠ¡ç«¯æ¥å£å®ç°ï¼Œå½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼",
			showCancel: false,
			confirmText: "äº†è§£"
		});
		console.log("æ›´æ–°åŠ¨æ€æ¶ˆæ¯å†…å®¹ï¼ˆéœ€è¦æœåŠ¡ç«¯æ”¯æŒï¼‰");
	};

	/**
	 * @desc æ›´æ–°è½¬å‘å±æ€§
	 */
	const setUpdateShare = () => {
		wx.updateShareMenu({
			// å±æ€§1ï¼šæ³¨æ„ï¼šåªæœ‰è½¬å‘åˆ°ç¾¤èŠè½¬å‘æˆ–ç§å¯†æ¶ˆæ¯ä¸­æ‰“å¼€æ‰å¯ä»¥è·å–åˆ° shareTicket è¿”å›å€¼ï¼Œå•èŠæ²¡æœ‰ shareTicketã€‚
			withShareTicket: true,
			// å±æ€§2ï¼šæ”¯æŒè½¬å‘åŠ¨æ€æ¶ˆæ¯ã€‚åŠ¨æ€æ¶ˆæ¯å¯¹æ¯”æ™®é€šæ¶ˆæ¯ï¼š
			// â‘ ã€æ¶ˆæ¯å‘å‡ºå»ä¹‹åï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡åå°æ¥å£ä¿®æ”¹éƒ¨åˆ†æ¶ˆæ¯å†…å®¹ã€‚
			// â‘¡ã€æ¶ˆæ¯æœ‰å¯¹åº”çš„æé†’æŒ‰é’®ï¼Œç”¨æˆ·ç‚¹å‡»æé†’æŒ‰é’®å¯ä»¥è®¢é˜…æé†’ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡åå°ä¿®æ”¹æ¶ˆæ¯çŠ¶æ€å¹¶æ¨é€ä¸€æ¬¡æé†’æ¶ˆæ¯ç»™è®¢é˜…äº†æé†’çš„ç”¨æˆ·
			// â‘¢ã€è®¾ç½®è¯¥å±æ€§åç¾¤å†…æ¶ˆæ¯ä¸å¯è½¬å‘
			isUpdatableMessage: true,
			// å±æ€§3ï¼šåŠ¨æ€æ¶ˆæ¯IDï¼›éœ€è¦æ ¹æ®æœåŠ¡ç«¯æ¥å£è·å–
			activityId: "1327_bkU7UKry/nvzrLxXY2SMZnrnwBBAK2JHBK7c0_CplGvRFKQ05MhzyxwRK4vbYqRtETjIvUoZ8UW_z7Zy",
			// å±æ€§4ï¼šç¾¤å¾…åŠæ¶ˆæ¯çš„IDï¼šéœ€è¦æ ¹æ®æœåŠ¡ç«¯æ¥å£è·å–
			templateInfo: {
				parameterList: [{
						name: "member_count",
						value: "1"
					},
					{
						name: "room_limit",
						value: "3"
					}
				],
				templateId: "21B034D08C5615B9889CE362BB957B1EE69A584B" //åº”ç”¨äºç»„é˜Ÿåœºæ™¯
			},
			success: () => {
				uni.showToast({
					title: "è®¾ç½®åŠ¨æ€æ¶ˆæ¯æˆåŠŸ"
				});
			}
		});
	};
	/**
	 * @desc è®¾ç½®èƒ¶å›Šåˆ†äº«æŒ‰é’®æ˜¯å¦å¯ç”¨
	 */
	const shareMenuShow = () => {
		uni.showShareMenu({
			title: "TodeAIæµ‹è¯•çš„åˆ†äº«",
			content: "TodeAIæµ‹è¯•çš„åˆ†äº«å†…å®¹",
			imageUrl: "",
			path: "",
			success: (res) => {
				uni.showToast({
					title: "è®¾ç½®æˆåŠŸ"
				});
			}
		});
		s;
		// å¾®ä¿¡å®˜æ–¹APIæ— æ³•è¿›è¡Œè½¬å‘å†…å®¹è®¾ç½®
		// wx.showShareMenu({
		// 	// å±æ€§1ï¼šæ³¨æ„ï¼šåªæœ‰è½¬å‘åˆ°ç¾¤èŠä¸­æ‰“å¼€æ‰å¯ä»¥è·å–åˆ° shareTicket è¿”å›å€¼ï¼Œå•èŠæ²¡æœ‰ shareTicketã€‚è½¬å‘ç§å¯†æ¶ˆæ¯æ—¶ï¼Œç¾¤èŠå’Œå•èŠéƒ½å¯è·å–åˆ° shareTicket
		// 	withShareTicket: true,
		// 	menus: ["shareAppMessage", "shareTimeline"],
		// 	success: () => {
		// 		uni.showToast({
		// 			title: "è®¾ç½®æˆåŠŸ"
		// 		});
		// 	}
		// });
	};
	const shareMenuHide = () => {
		wx.hideShareMenu({
			menus: ["shareAppMessage", "shareTimeline"],
			success: () => {
				uni.showToast({
					title: "è®¾ç½®éšè—æˆåŠŸ"
				});
			}
		});
	};
	/**
	 * @desc è½¬å‘åˆ†äº«å›¾ç‰‡æ¶ˆæ¯
	 */
	const shareImage = () => {
		wx.downloadFile({
			url: "https://res.wx.qq.com/wxdoc/dist/assets/img/demo.ef5c5bef.jpg",
			success: (res) => {
				wx.showShareImageMenu({
					path: res.tempFilePath
				});
			}
		});
	};
	/**
	 * @desc è§†é¢‘è½¬å‘åˆ†äº«
	 */
	const shareVoide = async () => {
		// callback å†™æ³•
		wx.downloadFile({
			url: "https://cdn.coverr.co/videos/coverr-temp-da2xinteriorboothat202505231700-mp4-4615/720p.mp4", // ä¸‹è½½url
			success(res) {
				console.log(res);
				// ä¸‹è½½å®Œæˆåè½¬å‘
				wx.shareVideoMessage({
					videoPath: res.tempFilePath,
					success() {},
					fail: console.error
				});
			},
			fail: console.error
		});
		// async await å†™æ³•
		// const res = await wx.downloadFile({
		// 	url: "https://cdn.coverr.co/videos/coverr-temp-da2xinteriorboothat202505231700-mp4-4615/720p.mp4" // ä¸‹è½½url
		// });
		// console.log(res);
		// // ä¸‹è½½å®Œæˆåè½¬å‘
		// await wx.shareVideoMessage({
		// 	videoPath: tempFilePath
		// });
	};
	/**
	 * @desc æ–‡ä»¶è½¬å‘åˆ†äº«
	 */
	const shareFlies = async () => {
		// callback å†™æ³•
		wx.downloadFile({
			url: "https://qdai.jinbang.minio.pyxshuzi.com/volunteer-prod/upload/excel/1748426870318.xlsx", // ä¸‹è½½url
			success(res) {
				console.log("shareFlies", res);
				// ä¸‹è½½å®Œæˆåè½¬å‘
				wx.shareFileMessage({
					filePath: res.tempFilePath,
					success() {},
					fail: console.error
				});
			},
			fail: console.error
		});

		// async await å†™æ³•
		// const { tempFilePath } = await wx.downloadFile({
		// 	url: URL // ä¸‹è½½url
		// });
		// // ä¸‹è½½å®Œæˆåè½¬å‘
		// await wx.shareFileMessage({
		// 	filePath: res.tempFilePath
		// });
	};
	/**
	 * @desc å¤åˆ¶é“¾æ¥æ“ä½œç›‘å¬:éœ€è¦åœ¨é¡µé¢åŠ è½½æ—¶è¿›è¡Œæ³¨å†Œ
	 */
	const copyUrl = () => {
		wx.onCopyUrl(() => {
			console.log("ç‚¹å‡»å¤åˆ¶é“¾æ¥è§¦å‘");
			//åœ¨è¿›å…¥é¡µé¢æ—¶è°ƒç”¨ wx.onCopyUrl è‡ªå®šä¹‰ queryï¼Œé€€å‡ºé¡µé¢æ—¶è°ƒç”¨ wx.offCopyUrlï¼Œé˜²æ­¢å½±å“å…¶å®ƒé¡µé¢
			return {
				query: "a=1&b=2"
			};
		});
	};
	/**
	 * @desc å¤åˆ¶é“¾æ¥ç›‘å¬å…³é—­
	 */
	const copyOff = () => {
		wx.offCopyUrl();
	};
</script>

<style lang="scss" scoped>
	.container {
		padding: 0 30rpx;
	}

	.dynamic-message-section {
		margin-top: 40rpx;
		padding: 30rpx;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		border-radius: 20rpx;
		box-shadow: 0 8rpx 30rpx rgba(102, 126, 234, 0.3);

		.section-title {
			display: block;
			font-size: 32rpx;
			font-weight: bold;
			color: #ffffff;
			margin-bottom: 30rpx;
			text-align: center;
		}

		.button-group {
			display: flex;
			gap: 20rpx;
			margin-bottom: 30rpx;

			.uv-button {
				flex: 1;
			}
		}

		.tips {
			background: rgba(255, 255, 255, 0.1);
			border-radius: 15rpx;
			padding: 25rpx;
			border: 1px solid rgba(255, 255, 255, 0.2);

			.tip-text {
				display: block;
				font-size: 28rpx;
				font-weight: bold;
				color: #ffffff;
				margin-bottom: 15rpx;
			}

			.tip-item {
				display: block;
				font-size: 24rpx;
				color: rgba(255, 255, 255, 0.9);
				line-height: 1.6;
				margin-bottom: 8rpx;
				padding-left: 10rpx;

				&:last-child {
					margin-bottom: 0;
				}
			}
		}
	}
</style>